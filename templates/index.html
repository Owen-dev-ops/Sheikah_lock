{% extends "layout.html" %}

{% block title %}{% endblock %}


{% block main %}

    <form id="login_manager" action="/reveal_login" method="post">
        <input id="login_manger_inputs" name="user_input" value="a" type="hidden">
        <!-- TODO: Add login search bar -->

        <!-- TODO: Add an "add login" button to the top left of the form. When click a modal appears wherer the user-->
        <!-- can enter one or more logins to the manager. After user clicks submit button in modal update table.-->
        <!-- https://www.w3schools.com/tags/att_button_form.asp -->

        <!-- TODO: Add a "remove login" button in the top right of this form. On click user can select rows via checkboxes-->
        <!-- to remove from the table. On second click ask user to confirm and when they confirm submit form to remove_login.html.-->
        <table>
            <tr>
                <th class="table_title" colspan="4"> Sheikah Lock </th>
            </tr>
            <tr>
                <td colspan="4">
                    <button id="add_login_button" type="button">Add Login</button> 
                    <button id="remove_login_button" type="button">Remove Login</button>
                </td>
            </tr>
            <tr>
                <th>Service</th>
                <th>Username</th>
                <th>Email</th>
                <th>Password</th>
            </tr>
            {% for row in user_logins %}
            <tr data-loginId="{{ row['id'] }}" class="table_row">
                <td> {{ row['service_name'] }} </td>
                <td> XXXX </td>
                <td> XXXX </td>
                <td> XXXX </td>
            </tr>
            {% endfor %} 
        </table>
    </form>      

    <dialog id="add_login_form">
        <div class="dialog_div">
            <h3>Add Login</h3>
            <!-- FUTURE FEATURES TODO LIST BELOW - DONT UPLOAD THIS WITH CS50 SBMISSION -->
            <!-- TODO: add a plus button below the table for adding new rows/opening this form. -->
            <!-- TODO: add a red trashcan button next to rows to delete. Make the select option appearable with a bulk delete button. -->
            <!-- TODO: Allow user to upload bulk logins. -->
            <form action="/new_login" method="post">
                <input type="text" name="service" placeholder="Service" required autocomplete="off">
                <input type="text" name="username" placeholder="Username" autocomplete="off">
                <input type="email" name="email" placeholder="Email" autocomplete="off">
                <input type="password" name="password" placeholder="Password" required autocomplete="off">
                <button type="submit">Add</button>
            </form>
            <button id="close_login_form">Close</button>
        </div>
    </dialog>

{% endblock %}


{% block scripts %}

    <script>

        // If there is a user message display it. 
        let modal = (document.getElementById("user_messages") == null) ? null : document.getElementById("user_messages");
        if (modal != null) {
            modal.showModal();

            setTimeout(() => {
                modal.close()
            }, 3000);
        }

        // Reveal login when user clicks on a row.
        document.addEventListener("DOMContentLoaded", () => {
            let rows = document.querySelectorAll("tr[data-loginID]");
            console.log(rows);

            rows.forEach((row) => {
                console.log(document.querySelector(row.dataset.loginId));
                row.addEventListener("click", () => {
                    console.log(row.dataset.loginId);
                    console.log(document.getElementById("login_manager_inputs").value)
                    document.getElementById("login_manager_inputs").value = row.dataset.loginId;
                    console.log(document.getElementById("login_manager_inputs").value)
                    // document.getElementById("login_manager").submit();
                });
            });
        });
    

        // Handles the add login button for adding new logins to the manager. Shows the add login dialog form.
        document.getElementById("add_login_button").addEventListener("click", () => {
            document.getElementById("add_login_form").showModal();
        });

        // Handles the button for closing the add login dialog form.
        document.getElementById("close_login_form").addEventListener("click", () => {
            document.getElementById("add_login_form").close();
        });

    </script>

{% endblock %}